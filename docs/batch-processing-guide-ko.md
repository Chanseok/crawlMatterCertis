# 배치 처리 구현 가이드

## 개요

크롤러의 배치 처리 시스템은 대규모 데이터 수집 작업을 관리 가능한 배치로 나누어 효율적으로 처리하도록 구현되었습니다. 이 접근 방식은 배치 간에 리소스를 해제하고 배치 사이에 구성 가능한 지연 시간을 추가하여 시스템 리소스 사용을 최적화합니다.

## 구현 세부 사항

배치 처리 기능은 다음과 같은 주요 구성 요소로 `CrawlerEngine.startCrawling()` 메서드에 구현되어 있습니다:

1. **설정 추출**:
   - `batchSize`: 배치당 페이지 수 (기본값: 30)
   - `batchDelayMs`: 배치 간 지연 시간(밀리초) (기본값: 2000)
   - `enableBatchProcessing`: 배치 처리 활성화 여부 (기본값: true)

2. **배치 처리 로직**:
   - 배치 처리가 활성화되어 있고 크롤링할 총 페이지 수가 배치 크기를 초과하면 시스템은 작업을 배치로 나눕니다
   - 각 배치는 독립적인 ProductListCollector 인스턴스로 처리됩니다
   - `cleanupResources()` 메서드를 사용하여 배치 간에 리소스를 정리합니다
   - 배치 간에 구성 가능한 지연 시간을 추가합니다

3. **리소스 관리**:
   - 각 배치 후에 ProductListCollector의 `cleanupResources()` 메서드가 호출됩니다
   - 이는 긴 크롤링 세션 동안 메모리 누수와 리소스 고갈을 방지하는 데 도움이 됩니다

## 설정 가이드

배치 처리 동작을 사용자 정의하려면 CrawlerConfig에서 다음 설정을 업데이트하세요:

```typescript
{
  // 배치 처리 설정
  "batchSize": 30,          // 배치당 페이지 수
  "batchDelayMs": 2000,     // 배치 간 지연 시간(밀리초)
  "enableBatchProcessing": true  // 배치 처리 사용 여부
}
```

### 권장 설정

#### 대규모 수집(100+ 페이지)의 경우:
- **batchSize**: 30-50 페이지
- **batchDelayMs**: 2000-5000ms
- **enableBatchProcessing**: true

#### 중간 규모 수집(30-100 페이지)의 경우:
- **batchSize**: 20-30 페이지
- **batchDelayMs**: 1000-2000ms
- **enableBatchProcessing**: true

#### 소규모 수집(<30 페이지)의 경우:
- **enableBatchProcessing**을 false로 설정하여 배치 처리를 비활성화하는 것을 고려하세요

## 성능 고려 사항

1. **메모리 사용량**:
   - 더 큰 배치 크기는 더 많은 메모리를 소비하지만 배치 전환의 오버헤드를 줄입니다
   - 제한된 메모리를 가진 시스템의 경우 더 작은 배치 크기를 사용하세요

2. **처리 시간**:
   - 배치 지연은 총 처리 시간을 증가시키지만 시스템 안정성을 보장하는 데 도움이 됩니다
   - 시스템의 성능 특성에 따라 지연 시간을 조정하세요

3. **오류 처리**:
   - 각 배치는 독립적으로 처리되어 실패를 격리하는 데 도움이 됩니다
   - 배치가 실패하더라도 후속 배치는 계속 처리될 수 있습니다

## 테스트 및 검증

배치 처리 구현을 검증하려면 제공된 테스트 스크립트를 사용하세요:

1. `batch-processing-test.js`: 다양한 배치 크기와 지연 시간을 테스트합니다
2. `resource-monitor.js`: 배치 처리 중 시스템 리소스 사용량을 모니터링합니다
3. `comprehensive-batch-test.js`: 테스트와 리소스 모니터링을 결합합니다

### 테스트 실행

모든 테스트를 실행하고 결과를 분석하려면 제공된 쉘 스크립트를 사용하세요:

```bash
# 프로젝트 루트로 이동
cd /path/to/crawlMatterCertis

# 테스트 스크립트 실행
./src/test/run-batch-tests.sh
```

이 스크립트는 다음을 수행합니다:
1. 기본 배치 처리 테스트 실행
2. `test-results` 디렉토리에 테스트 결과 수집
3. 결과 분석 및 권장 사항 생성
4. 분석 결과 요약 표시

### 테스트 분석

테스트를 실행한 후 다음 위치에서 상세한 분석 결과를 확인할 수 있습니다:
- `test-results/analysis/analysis-[timestamp].md`: 권장사항이 포함된 사람이 읽을 수 있는 분석 보고서
- `test-results/analysis/analysis-[timestamp].json`: 기계가 읽을 수 있는 분석 데이터

분석에는 다음이 포함됩니다:
- 최적의 배치 크기 권장
- 최적의 지연 시간 권장
- 배치 처리 활성화 여부 권장
- 다양한 구성 간의 성능 비교

특정 사용 사례에 최적의 설정을 결정하기 위해 다양한 구성으로 이러한 테스트를 실행하세요.

## 구현 상태

배치 처리 시스템이 성공적으로 구현되었으며 이제 사용할 준비가 되었습니다. 주요 변경 사항은 다음과 같습니다:

1. `CrawlerConfig` 인터페이스에 배치 처리 구성 옵션 추가
2. `CrawlerEngine.startCrawling()` 메서드에 배치 처리 로직 구현
3. 배치 간 리소스 정리 추가
4. 검증 및 성능 분석을 위한 테스트 스크립트 생성

## 향후 개선 가능성

1. **적응형 배치 크기 조정**: 시스템 리소스 가용성에 따라 배치 크기를 동적으로 조정
2. **배치 우선순위 지정**: 데이터 중요도에 따라 특정 배치 우선순위 지정
3. **병렬 배치 처리**: 제어된 리소스 할당으로 여러 배치를 병렬로 처리
4. **실패 복구**: 실패한 배치에 대한 고급 복구 메커니즘 구현
5. **배치 진행 상태 유지**: 중단된 크롤링 세션을 재개할 수 있도록 배치 간 진행 상태 저장
