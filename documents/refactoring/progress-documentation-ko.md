# Matter Certis 크롤러 리팩토링 문서

## 1. 리팩토링 개요

이 문서는 Matter Certis 크롤러의 코드베이스를 개선하기 위한 점진적 리팩토링 작업의 내용을 설명합니다. 목표는 유지보수성과 생산성을 높이면서 Clean Code 원칙을 적용하는 것입니다.

## 2. 1단계 리팩토링: 모듈화 및 코드 분리

### 2.1 파일 분리 및 모듈화

#### 2.1.1 오류 처리 클래스 분리
- 새 파일: `src/electron/crawler/utils/page-errors.ts`
- 페이지 작업과 관련된 모든 오류 클래스들을 한 곳에 정의
- 오류 타입별로 명확한 클래스 계층 구조화
- 기존의 인라인 오류 클래스 정의 제거

#### 2.1.2 캐싱 메커니즘 분리
- 새 파일: `src/electron/crawler/utils/page-cache-manager.ts`
- 범용 캐싱을 위한 `PageCacheManager<T>` 클래스 생성
- TTL 기반 캐싱 로직의 일반화 
- 전역 변수 기반 캐싱에서 객체 지향적 캐싱으로 전환

#### 2.1.3 타입 정의 분리
- 새 파일: `src/electron/crawler/tasks/product-list-types.ts`
- 제품 목록 수집 관련 인터페이스 및 타입 정의 통합
- 주요 데이터 구조 및 API 시그니처를 명확히 문서화

#### 2.1.4 상수 값 분리
- 새 파일: `src/electron/crawler/tasks/product-list-constants.ts`
- 매직 넘버 및 하드코딩된 상수값 통합 관리
- 설정 값에 대한 의미 있는 이름 부여

### 2.2 구현 변경 사항

#### 2.2.1 캐싱 로직 개선
- 전역 변수 기반 캐싱에서 `PageCacheManager` 활용으로 전환
- 기존 `cachedTotalPages`와 `cachedTotalPagesFetchedAt`를 `PageCacheManager` 인스턴스로 대체
- 캐시 무효화 및 갱신 로직 간소화

#### 2.2.2 주요 상수 통합
- 중복 정의된 상수들(재시도 횟수, 타임아웃 등)을 상수 파일에서 관리
- 설정 값에 대한 기본값 명확화

## 3. 다음 단계 계획

### 3.1 핵심 로직 분리 (2단계)
- ProductListCollector 클래스의 책임 분산
- 페이지 크롤링 로직 분리
- 데이터 변환 로직 분리
- 진행 상황 보고 로직 분리

### 3.2 구조적 개선 (3단계)
- 의존성 주입 패턴 적용
- 인터페이스 기반 설계로 전환
- 테스트 용이성 개선

## 4. 기술적 부채 해결

이번 리팩토링을 통해 해결된 기술적 부채:

- **코드 중복**: 오류 처리, 캐싱 로직 등의 중복 제거
- **책임 과중**: 단일 클래스가 너무 많은 책임을 지는 문제 완화
- **가독성 개선**: 관련 기능별 코드 그룹화로 가독성 향상
- **유지보수성**: 모듈화를 통한 코드 변경 영향 범위 축소

## 5. 테스트 및 검증 방법

리팩토링된 코드는 다음 방법으로 검증할 수 있습니다:

1. npm 스크립트를 통한 트랜스파일 검증: `npm run transpile:electron`
2. 주요 기능 테스트:
   - 제품 목록 페이지 수집
   - 캐싱 동작 확인
   - 오류 처리 시나리오 점검
3. 기존 동작과의 호환성 확인

## 6. 결론

이번 1단계 리팩토링을 통해 코드베이스의 구조적 개선이 이루어졌으며, 향후 기능 추가 및 유지보수가 용이해졌습니다. 다음 단계에서는 핵심 로직의 분리와 객체 지향 패턴 적용을 통해 더욱 견고한 아키텍처로 발전시킬 계획입니다.
