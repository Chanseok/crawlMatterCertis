# 배치 처리 테스트 가이드

## 개요

배치 처리 구현을 테스트하기 위한, 다양한 테스트 스크립트와 이를 실행하는 방법 및 결과를 해석하는 방법을 설명합니다.

## 테스트 스크립트

다음과 같은 테스트 스크립트를 제공합니다:

1. **간단한 테스트** (`simple-batch-test.js`)
   - 가장 기본적인 배치 처리 기능을 빠르게 검증
   - 목 구현을 사용하여 복잡한 의존성 없이 실행 가능
   - 빠른 피드백을 위한 최소한의 구성 사용

2. **기본 테스트** (`batch-processing-test.js`)
   - 다양한 배치 크기와 지연 시간으로 테스트
   - 배치 처리 비활성화 테스트 포함
   - 각 구성의 성능 및 자원 사용량 측정

3. **종합 테스트** (`comprehensive-batch-test.js`)
   - 테스트와 자원 모니터링을 결합
   - 더 많은 구성을 테스트하고 상세한 성능 보고서 생성
   - 다양한 배치 크기 및 지연 시간의 영향 분석

4. **엔드투엔드 테스트** (`e2e-batch-test.js`)
   - 실제 데이터 처리와 성능 특성을 사용한 테스트
   - 더 현실적인 워크로드로 배치 처리 성능 평가
   - 자세한 성능 분석 및 메모리 사용량 추적

## 테스트 실행 방법

테스트는 다음과 같은 방법으로 실행할 수 있습니다:

### 모든 테스트 실행

```bash
# 프로젝트 루트 디렉토리에서
./src/test/run-batch-tests.sh
```

이 스크립트는 다음을 수행합니다:

1. 필요한 경우 코드 트랜스파일
2. 테스트 디렉토리 생성
3. 단순 테스트 실행 후 검증
4. 기본 테스트 실행
5. 결과 분석 및 권장 구성 생성

### 개별 테스트 실행

특정 테스트만 실행하려면:

```bash
# 단순 테스트
node src/test/simple-batch-test.js

# 기본 테스트
node src/test/batch-processing-test.js

# 종합 테스트
node src/test/comprehensive-batch-test.js

# 엔드투엔드 테스트
node src/test/e2e-batch-test.js
```

## 테스트 결과 해석

테스트 결과는 `test-results` 디렉토리에 저장됩니다:

- `*.txt` 파일: 각 테스트의 원시 출력
- `analysis/*.md`: 사람이 읽을 수 있는 분석 보고서
- `analysis/*.json`: 기계가 읽을 수 있는 분석 데이터

### 주요 지표

다음과 같은 지표에 주목하세요:

1. **총 실행 시간**
   - 각 구성의 전체 실행 시간
   - 더 짧은 시간이 더 효율적인 구성을 의미

2. **배치 간 지연**
   - 구성된 지연 시간과 실제 지연 시간의 차이
   - 시스템 부하에 따라 실제 지연 시간이 더 길 수 있음

3. **메모리 사용량**
   - 피크 RSS 메모리: 프로세스가 사용한 최대 메모리
   - 피크 힙 사용량: JavaScript 객체가 사용한 최대 메모리
   - 배치 처리가 메모리 사용량을 효과적으로 관리하는지 확인

4. **배치 크기 효율성**
   - 배치 크기당 처리 시간
   - 너무 작은 배치는 오버헤드가 커지고, 너무 큰 배치는 메모리 문제를 일으킬 수 있음

## 권장 구성

분석 도구는 테스트 결과를 기반으로 최적의 구성을 권장합니다. 일반적인 권장 사항:

1. **대규모 수집 (100+ 페이지)**:
   - 배치 크기: 30-50 페이지
   - 배치 지연: 2000-5000ms
   - 배치 처리 활성화: true

2. **중간 규모 수집 (30-100 페이지)**:
   - 배치 크기: 15-30 페이지
   - 배치 지연: 1000-2000ms
   - 배치 처리 활성화: true

3. **소규모 수집 (<30 페이지)**:
   - 배치 처리 비활성화 고려 (enableBatchProcessing: false)

시스템 리소스와 구체적인 요구 사항에 따라 이러한 값을 조정하세요.

## 문제 해결

테스트 중 다음과 같은 문제가 발생할 수 있습니다:

1. **모듈 불러오기 오류**
   - `npm run transpile:electron` 실행으로 트랜스파일된 코드가 있는지 확인
   - 경로가 올바른지 확인

2. **분석 생성 실패**
   - `test-results/analysis` 디렉토리가 존재하는지 확인
   - 필요한 경우 수동으로 디렉토리 생성

3. **테스트 시간 이상**
   - 시스템 부하가 높은 경우 테스트 시간이 크게 달라질 수 있음
   - 여러 번 테스트를 실행하여 평균 성능 확인

## 결론

배치 처리 테스트는 시스템에 가장 적합한 배치 크기와 지연 시간을 찾는 데 도움이 됩니다. 다양한 구성으로 테스트를 실행하고 테스트 분석 도구를 사용하여 최적의 설정을 결정하세요.
