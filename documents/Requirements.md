# 제품 요구사항 문서 (PRD): Matter 인증 정보를 수집하는 Cross Platform 데스크톱 애플리케이션

## 1. 개요
- 문서 목적: 본 문서는 Matter 인증 제품 정보 크롤링 및 로컬 관리를 위한 데스크톱 애플리케이션 개발 요구사항을 정의합니다.
- 제품 목표: 
  - Connectivity Standards Alliance (CSA) 웹사이트에서 Matter 인증 제품 정보를 확인하여 로컬 데이터베이스에 아직 업데이트 되지 않은 정보들을 추가로 수집하여 저장합니다. 
  - 저장된 정보를 활용하여 주요한 통계정보를 테이블과 시각화를 통하여 제공하고 사용자의 추가적인 분석을 할 수 있도록 정보를 Excel로 내보내는 기능을 제공하는 Mac, Windows에서 구동 가능한 데스크톱 애플리케이션입니다. 
- 프로젝트 목표: Electron, Tauri 등을 활용한 Cross Platform Desktop Application이라는 형태로 Network을 통해 정보 수집을 효과적으로 하고 이를 데이터베이스로 관리하는 애플리케이션을 만들어가는 Best Practice를 구축하고 이를 프로그래밍 교육 자료로 활용할 수 있도록 한다. 
- 대상 사용자: Matter 인증 현황을 정기적으로 확인하거나 관련 정보를 로컬에서 빠르고 편리하게 참조해야 하는 기획자, 개발자, 제품 관리자 등입니다. 
- 버전: 1.0
- 최초 문서 작성일: 2025년 4월 20일

## 2. 목표
### 2.1 제품 목표
- 애플리케이션이 개발모드인지 실사용모드인지를 GUI로 구분하여 보여주고 정보 수집 요약 정보를 보여줍니다. (수집 후 업데이트된 날짜와 시각, 수집한 총 인증 정보의 수 등 로컬 데이터베이스의 요약 정보)
- 개발 모드의 지원, 즉 지속적인 기능 개선을 위해서 실제 CSA 웹사이트가 아닌 개발/테스트용 로컬 파일 정보를 Mock data로 사용하는 개발 모드를 지원합니다. 
  - 이 개발 모드에서는 여러 로컬 데이터베이스 파일을 지원하여 개발/테스트용 데이터베이스 파일과 실사용모드의 데이터베이스 파일을 모두 접근 가능합니다. 기본적으로 실 사용 모드에서의 데이터베이스 파일은 읽기 전용으로 접근할 수 있습니다. 
  - 데이터베이스 파일의 백업, 복원 기능을 제공합니다.   
- CSA 웹사이트의 Matter 인증 정보를 수집합니다. 
  - 크롤링 진행 상황 및 결과에 대한 시각적 피드백을 제공합니다. 
  - 진행 단계를 보여주고 남은 단계 정보를 포함하여 현 단계의 남은 시간, 총 예측 소요시간 등을 예측하여 Progress 시각화와 함께 제공합니다. 
  - 정보 수집, Crawling은 안정적이면서도 전체적으로는 최단 시간에 이루어질 수 있도록 복수의 crawling thread가 병렬적으로 데이터를 수집합니다. 
- 수집된 데이터는 로컬 환경(SQLite)에 안정적으로 저장합니다. 
  - 별도의 데이터베이스를 운영할 필요성이 없도록 애플리케이션에 내장하여 사용할 수 있는 SQLite3를 활용합니다. 
- 크롤링 작업 중에도 UI 응답성을 유지할 수 있습니다. 

### 2.2 과제 목표
- Cross Platform Desktop 애플리케이션의 Best Practice를 만듭니다. 
- 따라서 전체적인 SW 구조도 중요하지만 단계별로 하나 하나 만들어 가는 과정도 매우 중요하고 AI Coding Agent와의 협업도 매우 중요합니다. 
- 버전업 때마다 Release Note를 제공하는 것처럼 GitHub를 활용해서 매 중요한 단계 진전이 있을 때마다 구축 과정을 기록하여 이후 학습 대상자들의 길라잡이 역할을 할 수 있도록 합니다. 

## 3. 기능 요구사항

### 3.1. 크롤링 기능
FR-CRAWL-001: 사용자는 앱 내에서 CSA 웹사이트 Matter 인증 정보 크롤링 프로세스를 시작할 수 있어야 한다.
FR-CRAWL-002: 사용자는 진행 중인 크롤링 프로세스를 중지할 수 있어야 한다.
FR-CRAWL-003: 애플리케이션은 Playwright를 사용하여 CSA 웹사이트의 관련 페이지들을 탐색하고 데이터를 추출해야 한다.
FR-CRAWL-004: 크롤링 중 발생할 수 있는 일반적인 오류(네트워크 오류, 페이지 구조 변경 등)들은 별도의 재시도 로직을 통해 처리할 수 있어야 하고 재시도 limit까지 시도 이후에도 실패한 동작에 대해서는 별도로 오류 원인, 재시도 등의 조치 등을 기록하여 향후 프로그램 사용자가 판단할 수 있도록 해야 한다. 
FR-CRAWL-005: CSA Matter 인증 정보 페이지는 통상 12개의 제품 정보 카드로 이루어지고 있으므로 각 페이지를 모두 방문하여 페이지마다 제품 정보 카드들을 모두 읽어내어야 각 제품 별 URL에 다시 접근하여 제품의 Matter 인증 정보를 조회가 가능하다. 예를 들면 각 아래와 같은 정보를 얻을 수 있다. 페이지 수가 많으므로 multi-threads를 이용할 필요가 있다
``` {
    "url": "https://csa-iot.org/csa_product/wi-fi-bulb-rgbcw-89/",
    "manufacturer": "Tuya Global Inc.",
    "model": "Wi-Fi Bulb RGBCW",
    "certificateId": "CSA22042MAT40042-24",
  }
```
FR-CRAWL-006: 로컬 데이터베이스 상에 존재하는 데이터 이후에 추가로 새로 CSA 인증 정보 웹사이트에 추가된 인증 기기 정보에 대해서만 수집할 수 있어야 한다.
FR-CRAWL-007: 추출해야 하는 데이터 필드의 예시는 Json Object 형태로 다음과 같다:
``` {
    "id": "csa-matter-0-11",
    "manufacturer": "MMD HONG KONG HOLDING LIMITED",
    "model": "Philips 43PUS8909",
    "deviceType": "Matter Device",
    "certificationId": "CSA244D4MAT43911-00",
    "certificationDate": "2025-03-02",
    "softwareVersion": "TPN248E_V248.003.088.000",
    "hardwareVersion": "M0G",
    "vid": "0x1358",
    "pid": "0x8004",
    "familySku": "Philips 43PUS8909",
    "familyVariantSku": "",
    "firmwareVersion": "TPN248E_V248.003.088.000",
    "certificateId": "CSA244D4MAT43911-00",
    "familyId": "FAM226196",
    "tisTrpTested": "No",
    "specificationVersion": "1.2",
    "transportInterface": "Ethernet",
    "primaryDeviceTypeId": "0x0028",
    "applicationCategories": [
      "Matter Device"
    ]
} 
```

### 3.2. 데이터 저장 기능
FR-STORE-001: 크롤링을 통해 추출된 인증 정보는 로컬 SQLite 데이터베이스 파일에 저장되어야 한다.
FR-STORE-002: 데이터 저장 시 새로 수집한 데이터와 기존 동일한 인증 ID의 데이터가 모두 존재하는데 서로 정보가 일치하지 않을 때는 프로그램 사용자가 이후에 어느 정보를 반영할 지 결정할 수 있도록 별도의 테이블로 관리하고 이를 프로그램 사용자가 선택할 수 있는 기능을 제공해야 한다. 
FR-STORE-003: 데이터베이스 스키마는 추출 필드를 저장하기에 적합하게 설계되어야 한다.

### 3.3. 사용자 인터페이스 (UI) 기능
FR-UI-001: 사용자가 크롤링을 시작/중지할 수 있는 명확한 버튼(또는 컨트롤)을 제공해야 한다.
FR-UI-002: 크롤링 진행 상황을 시각적으로 표시해야 한다 (예: 진행률 표시줄, 처리된 페이지 수, 찾은 항목 수 등).
FR-UI-003: 크롤링 과정에서 발생하는 주요 이벤트 및 오류에 대한 로그 메시지를 실시간으로 표시하는 영역이 있어야 한다.
FR-UI-004: 크롤링 작업이 완료되거나 중지된 후 최종 상태(성공, 실패, 중지)를 사용자에게 명확히 알려야 한다.
FR-UI-005: 사용자는 로컬 SQLite 데이터베이스에 저장된 인증 정보를 앱 내에서 조회할 수 있어야 한다. (조회 방식은 테이블 형태)
FR-UI-006: 사용자는 저장된 데이터를 검색하거나 필터링할 수 있어야 한다. (검색/필터링 기준 정의 필요)
FR-UI-007: Excel 또는 CSV 형식으로 파일 내보내기 기능이 있어야 한다. 

## 4. 비기능 요구사항

NFR-PERF-001: 크롤링 작업이 백그라운드(Worker Thread)에서 실행되어 장시간 실행되더라도 UI는 멈추지 않고 응답성을 유지해야 한다.
NFR-USAB-001: 사용자는 별도의 복잡한 설정 없이 애플리케이션을 쉽게 설치하고 실행할 수 있어야 한다.
NFR-PLAT-001: 애플리케이션은 macOS 및 Windows 운영체제에서 안정적으로 동작해야 한다.
NFR-DEVE-001: 개발 중 HMR(Hot Module Replacement) 등을 활용하여 개발 생산성이 높아야 한다.

## 5. 기술 명세

데스크톱 프레임워크: Electron
UI 라이브러리 (Renderer): React
빌드 도구 (UI): Vite
UI 상태 관리: Nanostores (대안: Zustand, Jotai)
UI 스타일링: Tailwind CSS
웹 크롤링 엔진: Playwright
데이터베이스: SQLite
DB 연동 라이브러리 (Main): better-sqlite3 (대안: Prisma)
프로세스 관리: Node.js worker_threads (크롤링용)
IPC: Electron ipcMain, ipcRenderer, contextBridge (Preload 스크립트 활용)
패키징: Electron Forge 또는 Electron Builder

## 6. 아키텍처 개요

Main Process: Electron 앱 생명주기 관리, BrowserWindow 생성, IPC 메시지 수신/전송, Worker Thread 관리 담당. SQLite DB 접근 로직 포함 (또는 Worker에서 직접 접근).
Renderer Process: React 기반 UI 렌더링, 사용자 인터랙션 처리, IPC를 통해 Main 프로세스와 통신, 상태 관리.
Worker Thread: Playwright 크롤링 실행, 데이터 추출, (선택적으로) SQLite 데이터 직접 저장. 처리 결과 및 진행 상황을 Main 프로세스에 보고.
Preload Script: Main과 Renderer 간의 안전한 IPC 통신 중개.

## 7. UI/UX 고려사항 (초기)

직관적인 인터페이스: 시작/중지 버튼, 명확한 상태 표시.
진행률 시각화: 진행률 바 또는 유사한 시각적 요소.
로그 가독성: 로그 메시지를 명확하고 읽기 쉽게 표시.
데이터 표시: 저장된 데이터를 테이블 또는 리스트 형태로 표시.

## 8. 향후 고려사항

고급 데이터 필터링 및 검색 기능 추가
데이터 내보내기 기능 (CSV 등)
CSA 웹사이트 구조 변경에 대한 대응 방안 마련 (크롤링 로직 업데이트 용이성)
애플리케이션 자동 업데이트 기능 구현
Tauri 기반으로의 전환 가능성 (현재는 Electron 유지)

### 8.1 Tauri 마이그레이션 전략
만약 애플리케이션의 크기와 리소스 사용량 최적화를 위해 Electron에서 Tauri로 전환하게 된다면, 다음과 같은 구조적 준비가 필요합니다:

- **아키텍처 분리**: 백엔드(Main Process)와 프론트엔드(Renderer Process) 코드를 명확히 분리하고, 통신 인터페이스를 추상화
- **플랫폼 독립적 설계**: 
  - OS 특화 기능을 별도 모듈로 격리
  - Electron IPC와 Tauri Command API의 차이를 흡수할 어댑터 레이어 구현
- **점진적 마이그레이션 계획**: 
  - 핵심 기능부터 우선 마이그레이션
  - 통합 테스트를 통한 기능 동등성 검증
- **공통 상태 관리**: 프론트엔드 상태 관리는 Electron/Tauri와 무관하게 동작하도록 설계

이러한 준비는 개발 초기부터 점진적으로 진행하는 것이 비용 효율적이며, 애플리케이션 구조의 유연성과 확장성에도 도움이 됩니다.

### 8.2 향후 Tauri 전환 대비 메모
Tauri 전환을 위한 기본은 준비하였으나 향후에 완전한 마이그레이션을 위해 살펴봐야 할 포인트들을 기재해둡니다. 
#### 주의사항 및 추가 작업
이 변경은 기존 코드를 크게 변경하지 않으면서 플랫폼 전환을 위한 준비를 하는 것이 목표였습니다. 하지만 완전한 마이그레이션을 위해서는 다음과 같은 추가 작업이 필요할 수 있습니다:

1. **백엔드 코드 분리**: 현재 Electron의 main 프로세스 코드를 백엔드와 Electron 특화 코드로 분리
2. **파일 시스템 접근**: 파일 시스템 접근 코드를 추상화하여 각 플랫폼 독립적으로 만들기
3. **창 관리**: 창 관리 코드(BrowserWindow 등)를 추상화하여 Tauri의 창 관리와 호환되도록 만들기
4. **빌드 설정**: Vite 설정을 Tauri와 호환되도록 조정

## 9. 미해결 질문 및 이슈

크롤링 대상 데이터 필드의 최종 목록 확정 필요
데이터 중복 처리 정책 (업데이트 vs. 무시 vs. 기타) 정의 필요
상세 오류 처리 시나리오 및 사용자 피드백 방안 정의 필요
저장된 데이터의 구체적인 조회/검색/필터링 UI/UX 정의 필요